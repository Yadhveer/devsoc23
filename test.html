<!DOCTYPE html>
<html>
  <head>
    <title>Flux Eco</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places"></script>
    <style>
      #map {
        height: 400px;
        width: 100%;
        margin: 0 auto;
        border-radius: 20px;
      }
      .form-container {
        text-align: center;
      }
      .form-container label {
        display: block;
        margin-bottom: 5px;
        margin-top: 15px;
        font-size: 18px;
        font-family: "Lucida Sans", "Lucida Sans Regular", "Lucida Grande",
          "Lucida Sans Unicode", Geneva, Verdana, sans-serif;
        color: azure;
      }
      .form-container input[type="text"] {
        width: 30%;
        margin-bottom: 10px;
        padding: 5px;
        font-size: 14px;
        border-radius: 15px;
      }
      .form-container button {
        display: block;
        width: 10%;
        padding: 10px;
        font-size: 14px;
        margin-left: 575px;
        background-color: #b54204;
        color: #fff;
        outline: 2px solid #b54204;
        outline-offset: 4px;
        border-radius: 30px;
        margin-top: 30px;
      }
    </style>
    <script>
      let map;
      let directionsService;
      let directionsRenderer;
      const geojsonMarkers = [];
      const bufferRadius = 10;

      function initMap() {
        // Create a new map instance
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: -31.9523, lng: 115.8613 },
          zoom: 12,
        });

        // Create a DirectionsService object
        directionsService = new google.maps.DirectionsService();

        // Create a DirectionsRenderer object
        directionsRenderer = new google.maps.DirectionsRenderer({
          map: map,
          polylineOptions: {
            strokeColor: "blue",
            strokeOpacity: 0.5,
            strokeWeight: 8,
            fillOpacity: 0.2,
            fillColor: "blue",
          },
        });

        // Load the GeoJSON file and create markers for the coordinates
        loadGeoJSONAndCreateMarkers();

        // Add a click event listener to calculate the markers within the route
        document
          .getElementById("calculate-route")
          .addEventListener("click", calculateMarkersInRoute);
      }

      function loadGeoJSONAndCreateMarkers() {
        // Load the GeoJSON file
        map.data.loadGeoJson("Traffic_Signal_Sites.geojson");

        // Wait for the GeoJSON data to load
        map.data.addListener("addfeature", function (event) {
          // Check if the added feature is a point
          if (event.feature.getGeometry().getType() === "Point") {
            const coordinate = event.feature.getGeometry().get();

            // Create a marker for each coordinate with a buffer
            const markerWithBuffer = addMarkerWithBuffer(
              map,
              coordinate,
              bufferRadius
            );

            // Add the marker to the GeoJSON markers array
            geojsonMarkers.push(markerWithBuffer);
          }
        });
      }

      function addMarkerWithBuffer(map, position, bufferRadius) {
        // Create the marker
        const marker = new google.maps.Marker({
          position: position,
          map: map,
        });

        // Create the circle overlay with the buffer
        const buffer = new google.maps.Circle({
          center: position,
          radius: bufferRadius,
          map: map,
          fillColor: "blue",
          fillOpacity: 0.2,
          strokeColor: "blue",
          strokeOpacity: 0.5,
          strokeWeight: 2,
        });

        // Return the marker and buffer as a single object
        return {
          marker: marker,
          buffer: buffer,
        };
      }

      function calculateMarkersInRoute() {
        // Get the origin and destination input values from the user
        const origin = document.getElementById("origin").value;
        const destination = document.getElementById("destination").value;

        // Define the request object for the directions service
        const request = {
          origin: origin,
          destination: destination,
          travelMode: google.maps.TravelMode.DRIVING,
        };

        // Make a request to the directions service
        directionsService.route(request, function (result, status) {
          if (status === "OK") {
            // Display the route on the map
            directionsRenderer.setDirections(result);

            // Get the bounds of the route
            const routeBounds = result.routes[0].bounds;

            // Count the number of GeoJSON markers within the route
            let markerCount = 0;
            geojsonMarkers.forEach(function (markerWithBuffer) {
              const marker = markerWithBuffer.marker;
              const buffer = markerWithBuffer.buffer;

              // Check if the marker position or buffer intersects with or is contained within the route bounds
              if (
                routeBounds.intersects(buffer.getBounds()) ||
                routeBounds.contains(marker.getPosition())
              ) {
                markerCount++;
              }
            });

            // Display the marker count
            alert("Number of markers in the route: " + markerCount);
          }
        });
      }
    </script>
  </head>
  <body>
    <div id="map"></div>

    <div class="form-container">
      <label for="origin">Origin:</label>
      <input type="text" id="origin" placeholder="Enter origin" />
      <label for="destination">Destination:</label>
      <input type="text" id="destination" placeholder="Enter destination" />
      <button id="calculate-route">Start</button>
    </div>
    <style>
      body {
        background-image: url("treeblur.jpg");
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
      }
    </style>
    <script
      async
      defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBzwjNe11Q_bnonrQVs8uj1xwjyoI73t4E&callback=initMap"
    ></script>
  </body>
</html>